## Firewall ##

### Autostart iptables ###
```
sudo sh -c "iptables-save > /etc/network/iptables"
sudo touch /etc/network/if-pre-up.d/iptables
sudo chmod +x /etc/network/if-pre-up.d/iptables
```

sudo nano /etc/network/if-pre-up.d/iptables
```
#!/bin/sh
/sbin/iptables-restore /etc/network/iptables
```
### Test/Show ###
Für Fehlersuche alle Regeln bis zum nächsten Neustart disablen: sudo iptables -F
Anzeige aktive Table: sudo iptables -L -v
Log controllieren: tailf /var/log/kern.log

### Beispiel ###
```
# Generated DL2NEW 31.01.2018
*filter
#
# Zur Sicherheit drop wenn keine Regel zutrifft
#
:INPUT DROP [0:0]
:FORWARD DROP [0:0]
:OUTPUT DROP [0:0]
#
# Loopback generell erlaubt
#
-A INPUT -i lo -j ACCEPT
#
# Block korrupten Traffic an Host gerichtet
#
-A INPUT -p tcp -m tcp ! --tcp-flags FIN,SYN,RST,ACK SYN -m state --state NEW -j DROP
-A INPUT -f -j DROP
#
# Accept an Host gerichtet - Interface egal: laufende Session, ping
#
-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT -p icmp -j ACCEPT
#
# Accept an Host gerichtet - von Interface wlan0=home: GRE Tunnel, SSH, RDP
#
-A INPUT -i wlan0 -p gre -j ACCEPT
-A INPUT -i wlan0 -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT
-A INPUT -i wlan0 -p tcp -m state --state NEW -m tcp --dport 3389 -j ACCEPT
#
# Accept an Host gerichtet - von Interface eth0=Hamnet: http
#
#-A INPUT -i eth0 -p tcp -m state --state NEW -m tcp --dport 80 -j ACCEPT
#
# Rest drop
#
-A INPUT -j REJECT --reject-with icmp-host-prohibited
#
# Routing = FORWARD Traffic
# Hamnet Interface: eth0
# Home   Interface: wlan0
#
# tcp Traffic inkl. Rueckkanal
#
-A FORWARD -i wlan0 -o eth0 -p tcp -j ACCEPT
-A FORWARD -i eth0 -o wlan0 -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
#
# Rest drop
#
-A FORWARD -j REJECT --reject-with icmp-host-prohibited
#
# UDP Traffic
#
#-A FORWARD -i wlan0 -o eth0 -p udp -j ACCEPT
#-A FORWARD -i eth0 -o wlan0 -p udp -j ACCEPT
#
-A OUTPUT -j ACCEPT
#
COMMIT
# Completed DL2NEW 31.01.2018
#
# Beipiele
# -A FORWARD -d 2.2.2.2 -i eth0 -p tcp -m tcp --dport 3389 -j ACCEPT # TCP mit Destination
# -A FORWARD -i eth0 -p udp -m udp --dport 1000:65500 # UDP Port Range
# -A FORWARD -d 2.2.2.2 -i eth0 -p udp -m udp --dport 1111 # UDP Einzelport mit Destination
#
# NAT derzeit nicht genutzt
#
# Generated by iptables-save v1.6.0 on Sun Dec 3 15:10:28 2017
#*nat
#:PREROUTING ACCEPT [0:0]
#:INPUT ACCEPT [0:0]
#:OUTPUT ACCEPT [0:0]
#:POSTROUTING ACCEPT [0:0]
#-A POSTROUTING -o eth0 -j MASQUERADE
#-A POSTROUTING -o ppp0 -j MASQUERADE
#-A POSTROUTING -o wlan0 -j MASQUERADE
#COMMIT
# Completed on Sun Dec 3 15:10:28 2017
```
